org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.colorpicker-1.0/editor/libs/spectrum.js', 'js')
org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.colorpicker-1.0/editor/libs/spectrum.css', 'css')
org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.colorpicker-1.0/editor/colorpickerplugin.css', 'css')
org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.colorpicker","ver":"1.0","author":"Chetan Sachdev","title":"Colorpicker Plugin","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","dependencies":[{"type":"js","src":"editor/libs/spectrum.js"},{"type":"css","src":"editor/libs/spectrum.css"},{"type":"css","src":"editor/colorpickerplugin.css"}],"menu":[]},"renderer":{}},eval('org.ekstep.contenteditor.basePlugin.extend({type:"colorpicker",picker:[],initialize:function(){ecEditor.addEventListener("colorpicker:state",this.invoke,this)},invoke:function(e,t){var c=this;"added"!=ecEditor.jQuery("#"+t.id+" input").attr("colorpicker")&&(this.picker[t.id]=ecEditor.jQuery("#"+t.id+" input").spectrum({color:"#FF0000",showInput:!0,showAlpha:!1,preferredFormat:"hex",showButtons:!1,containerClassName:"awesome",clickoutFiresChange:!1,showButtons:!0,change:function(e){t.callback(t.id,e.toHexString()),ecEditor.getService(ServiceConstants.TELEMETRY_SERVICE).interact({type:"click",subtype:"change",target:"colorpicker",pluginid:c.manifest.id,pluginver:c.manifest.ver,objectid:t.id,stage:ecEditor.getCurrentStage().id})},showPaletteOnly:!0,togglePaletteOnly:!0,togglePaletteMoreText:"more",togglePaletteLessText:"less",color:"blanchedalmond",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],maxSelectionSize:10,hideAfterPaletteSelect:!0,move:function(e){t.callback(t.id,e.toHexString()),ecEditor.getService(ServiceConstants.TELEMETRY_SERVICE).interact({type:"click",subtype:"move",target:"colorpicker",pluginid:c.manifest.id,pluginver:c.manifest.ver,objectid:t.id,stage:ecEditor.getCurrentStage().id})}}),ecEditor.jQuery("#"+t.id+" input").attr("colorpicker","added")),t&&t.color?ecEditor.jQuery("#"+t.id+" input").spectrum("set",t.color):ecEditor.jQuery("#"+t.id+" input").spectrum("set","#000000")}});'))
org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.config-1.0/editor/libs/jquery-ui.min.js', 'js')
org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.config-1.0/editor/config.css', 'css')
org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.config","ver":"1.0","author":"Santhosh Vasabhaktula","title":"Config Plugin","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","dependencies":[{"type":"js","src":"editor/libs/jquery-ui.min.js"},{"type":"css","src":"editor/config.css"},{"type":"plugin","plugin":"org.ekstep.colorpicker","ver":"1.0"}],"sidebarMenu":[{"id":"settings","type":"icon","toolTip":"Settings","title":"Settings","iconClass":"settings icon","templateURL":"editor/partials/sidebarSettingTemplate.html","controllerURL":"editor/sidebar-settings-controller.js"}]}},eval('org.ekstep.contenteditor.basePlugin.extend({type:"config",initialize:function(){org.ekstep.contenteditor.api.addEventListener("org.ekstep.config:invoke",this.invoke,this),org.ekstep.contenteditor.api.addEventListener("org.ekstep.config:toggleStageEvent",this.toggleEventToStage,this),org.ekstep.contenteditor.api.addEventListener("config:updateValue",this.updateConfig,this),org.ekstep.contenteditor.api.addEventListener("config:on:change",this._onConfigChange,this),org.ekstep.contenteditor.api.addEventListener("config:add",this.addConfig,this);var e=org.ekstep.contenteditor.api.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/colorpicker-directive.js");org.ekstep.contenteditor.api.getService(ServiceConstants.POPUP_SERVICE).loadNgModules(void 0,e)},updateConfig:function(e,t){var n=this,o=org.ekstep.contenteditor.api._.reduce(t.oldValue,function(e,n,o){return org.ekstep.contenteditor.api._.isEqual(n,t.newValue[o])?e:e.concat(o)},[]);org.ekstep.contenteditor.api._.forEach(o,function(e){n.onConfigChange(e,t.newValue[e])})},_onConfigChange:function(e,t){this.onConfigChange(t.key,t.value)},onConfigChange:function(e,t){var n=org.ekstep.contenteditor.api.getCurrentObject()?org.ekstep.contenteditor.api.getCurrentObject():org.ekstep.contenteditor.api.getCurrentStage();!org.ekstep.contenteditor.api._.isUndefined(t)&&n&&(n._onConfigChange(e,t),n.onConfigChange(e,t),"autoplay"===e&&this.toggleEventToStage("",{flag:t,id:n.id}))},invoke:function(e,t){var n=this;if("browser"==t.type||"button"==t.type){var o=t.type;org.ekstep.contenteditor.api.dispatchEvent(t.event.id,{type:t.event.type,callback:function(e){n.onConfigChange(o,e)}})}},toggleEventToStage:function(e,t){var n=org.ekstep.contenteditor.api.getCurrentStage(),o=-1;n.event&&_.forEach(n.event,function(e,n){org.ekstep.contenteditor.api._.isArray(e.action)?e.action[0].asset===t.id&&(o=n):org.ekstep.contenteditor.api._.isObject(e.action)&&e.action.asset===t.id&&(o=n)}),!0===t.flag&&-1===o?n.addEvent({type:"enter",action:[{id:UUID(),type:"command",command:"play",asset:t.id}]}):!1===t.flag&&-1!==o&&n.event.splice(o,1)}});'))
org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.text-1.2/editor/texteditor.js', 'js')
org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.text-1.2/editor/multilineTransliterator.js', 'js')
org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.text-1.2/editor/textWYSIWYG.js', 'js')
org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.text-1.2/editor/style/plugin.css', 'css')
org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.text","ver":"1.2","shortId":"org.ekstep.text","displayName":"Text","author":"Santhosh Vasabhaktula","title":"Text Plugin","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","dependencies":[{"type":"js","src":"editor/texteditor.js"},{"type":"js","src":"editor/multilineTransliterator.js"},{"type":"js","src":"editor/textWYSIWYG.js"},{"type":"css","src":"editor/style/plugin.css"}],"menu":[{"id":"org.ekstep.text","category":"main","type":"icon","toolTip":"Add Text","title":"Text","iconClass":"fa fa-font","onclick":{"id":"org.ekstep.text:create","data":{"__text":"","x":10,"y":20,"fontFamily":"NotoSans","fontSize":18,"minWidth":20,"w":35,"maxWidth":500,"fill":"#000000","fontStyle":"normal","fontWeight":"normal","stroke":"rgba(255, 255, 255, 0)","strokeWidth":1,"opacity":1,"editable":false,"lineHeight":1,"version":"V2","offsetY":0.2}},"submenu":[{"id":"beginning","type":"icon","title":"Add Richtext","iconClass":"","onclick":{"id":"org.ekstep.richtext:showpopup"}}]}],"behaviour":{"rotatable":true},"configManifest":[{"type":"custom_template","controllerURL":"editor/config-controller.js","templateURL":"editor/configTemplate.html"}],"help":{"src":"editor/help.md","dataType":"text"},"init-data":{"__text":"","x":10,"y":20,"fontFamily":"NotoSans","fontSize":18,"minWidth":20,"w":35,"maxWidth":500,"fill":"#000000","fontStyle":"normal","fontWeight":"normal"}},"renderer":{"main":"renderer/supertextplugin.js"}},eval('org.ekstep.contenteditor.basePlugin.extend({type:"org.ekstep.text",magicNumber:1920,editorWidth:720,supportedFonts:["NotoSans","NotoSansBengali","NotoSansDevanagari","NotoSansGujarati","NotoSansGurmukhi","NotoSansKannada","NotoSansMalayalam","NotoSansOriya","NotoSansTamil","NotoSansTelugu","NotoNastaliqUrdu"],initialize:function(){var t=this;ecEditor.addEventListener(this.type+":showpopup",this.loadHtml,this),ecEditor.addEventListener("object:unselected",this.objectUnselected,this),ecEditor.addEventListener("stage:unselect",this.stageUnselect,this),ecEditor.addEventListener(this.type+":readalong:show",this.showReadalong,this),ecEditor.addEventListener(this.type+":wordinfo:show",this.showWordInfo,this),ecEditor.addEventListener(this.type+":delete:enhancement",this.deleteEnhancement,this),ecEditor.addEventListener(this.type+":modified",this.modifyText,this);var e=ecEditor.resolvePluginResource(t.manifest.id,t.manifest.ver,"editor/delete_confirmation_dialog.html");ecEditor.getService("popup").loadNgModules(e);var i=ecEditor.resolvePluginResource(t.manifest.id,t.manifest.ver,"editor/transliterationconfig.html"),o=ecEditor.resolvePluginResource(t.manifest.id,t.manifest.ver,"editor/transliterationapp.js");org.ekstep.contenteditor.api.getService(ServiceConstants.POPUP_SERVICE).loadNgModules(i,o)},modifyText:function(t){this.checkMigrate(),this.dblClickHandler(t)},checkMigrate:function(){this.isV2Plugin(ecEditor.getCurrentObject())||ecEditor.dispatchEvent(this.type+":migrate",ecEditor.getCurrentObject())},loadHtml:function(){var t=this;org.ekstep.contenteditor.api.getService(ServiceConstants.POPUP_SERVICE).open({template:"transliteration",controller:"transliterationController",controllerAs:"$ctrl",resolve:{instance:function(){return t}},width:900,showClose:!1})},createTransliteratedText:function(t){var e=org.ekstep.contenteditor.api.getCurrentObject(),i={__text:t,x:30,y:30,w:300,h:500,fontFamily:"NotoSans",fontSize:18,minWidth:20,maxWidth:500,fill:"#000"};e&&(i.x=e.attributes.x,i.y=e.attributes.y,i.w=e.attributes.w,i.h=e.attributes.h,i.fontFamily=e.attributes.fontFamily,i.fontSize=e.attributes.fontSize,i.minWidth=e.attributes.minWidth,i.maxWidth=e.attributes.maxWidth,i.color=e.attributes.color,this.pixelToPercent(i),i=this.getOffsetPosition(i)),org.ekstep.contenteditor.api.instantiatePlugin(e.type,i,org.ekstep.contenteditor.api.getCurrentStage())},getOffsetPosition:function(t){return t.x+t.w<50?t.x=50:t.x>=50?t.x=12:t.y+t.h<50?t.y=50:t.y>=50?t.y=12:(t.x+=20,t.y+=20),t},newInstance:function(){var t=this.convertToFabric(this.attributes);if(delete t.__text,ecEditor._.isUndefined(this.config.text)&&(this.config.text=ecEditor._.isUndefined(this.attributes.__text)?"":this.attributes.__text),ecEditor._.isUndefined(this.attributes.__text)||delete this.attributes.__text,t.editable=!1,this.editorObj=new fabric.ITextbox(this.config.text,t),""==this.config.text&&textEditor.showEditor(this.id),this.isV2Plugin()){TextWYSIWYG.setInstance(this);var e=ecEditor.getCanvas();this.attributes.parentW=e.width,this.attributes.parentH=e.height}if(ecEditor._.isUndefined(this.attributes.timings)&&"readalong"!==this.attributes.textType)if(ecEditor._.isUndefined(this.attributes.words)&&"wordinfo"!==this.attributes.textType)this.attributes.textType="text";else{var i=this;this.addMedia({id:"org.ekstep.text.popuptint",src:ecEditor.resolvePluginResource(i.manifest.id,i.manifest.ver,"assets/popuptint.png"),type:"image",assetId:"org.ekstep.text.popuptint"}),this.addWordinfoconfigManifest(this)}else{if(ecEditor._.isUndefined(this.attributes.textType)){this.attributes.textType="readalong",this.config.audio=this.attributes.audio,this.config.timings=this.attributes.timings,this.config.highlight=this.attributes.highlight,this.config.autoplay=this.attributes.autoplay;var o=ecEditor.getMedia(this.attributes.audio);o.src=org.ekstep.contenteditor.mediaManager.getMediaOriginURL(o.src),ecEditor._.isUndefined(o.preload)&&(o.preload=!0),this.config.audioObj=o}this.addMedia(this.config.audioObj),this.addReadalongconfigManifest(this)}},selected:function(t){fabric.util.addListener(fabric.document,"dblclick",this.dblClickHandler)},deselected:function(t,e,i){fabric.util.removeListener(fabric.document,"dblclick",this.dblClickHandler)},objectUnselected:function(t,e){fabric.util.removeListener(fabric.document,"dblclick",this.dblClickHandler)},dblClickHandler:function(t){var e=ecEditor.getCurrentObject().editorObj.getBoundingRect(),i=ecEditor.jQuery("#canvas").offset().left+ecEditor.getCurrentObject().editorObj.left,o=i+ecEditor.getCurrentObject().editorObj.width,r=ecEditor.jQuery("#canvas").offset().top+ecEditor.getCurrentObject().editorObj.top,n=r+ecEditor.getCurrentObject().editorObj.height;_.isObject(e)&&(i=ecEditor.jQuery("#canvas").offset().left+e.left,eftEnd=i+e.width,r=ecEditor.jQuery("#canvas").offset().top+e.top,n=r+e.height),t.clientX>i&&t.clientX<o&&t.clientY>r&&t.clientY<n&&textEditor.showEditor(ecEditor.getEditorObject().id),textEditor.generateTelemetry({type:"click",subtype:"doubleClick",target:"textEditor"})},stageUnselect:function(t){textEditor.hide()},getAttributes:function(){var t=ecEditor._.omit(ecEditor._.clone(this.attributes),["top","left","width","height","fontFamily","fontfamily","fontSize","fontstyle","fontweight","scaleX","scaleY"]);t.font=this.editorObj.get("fontFamily"),t.fontsize=this.updateFontSize(this.editorObj.get("fontSize"),!1);var e=ecEditor._.isUndefined(this.editorObj.get("fontWeight"))?"":"bold"===this.editorObj.get("fontWeight")?"bold":"",i=ecEditor._.isUndefined(this.editorObj.get("fontStyle"))?"":"italic"===this.editorObj.get("fontStyle")?"italic":"";return t.weight=(e+" "+i).trim(),t},onConfigChange:function(t,e){switch(t){case"fontweight":this.editorObj.setFontWeight(e?"bold":"normal"),this.attributes.fontweight=e;break;case"fontstyle":this.editorObj.setFontStyle(e?"italic":"normal"),this.attributes.fontstyle=e;break;case"fontfamily":this.editorObj.setFontFamily(e),this.attributes.fontFamily=e,this.attributes.fontfamily=e;break;case"fontsize":this.editorObj.setFontSize(e),this.attributes.fontSize=e;break;case"textcolor":this.editorObj.setFill(e),this.attributes.color=e;break;case"align":this.editorObj.setTextAlign(e),this.attributes.align=e;break;case"highlightcolorpicker":this.config.highlight=e;break;case"autoplay":this.config.autoplay=e;break;case"wordfontcolorpicker":this.config.wordfontcolor=e;break;case"wordhighlightcolorpicker":this.config.wordhighlightcolor=e;break;case"wordunderlinecolorpicker":this.config.wordunderlinecolor=e}this.isV2Plugin()&&TextWYSIWYG.setInstance(this),ecEditor.render(),ecEditor.dispatchEvent("object:modified",{target:ecEditor.getEditorObject()})},getConfig:function(){var t=this._super();return t.color=this.attributes.color||this.attributes.fill,t.fontfamily=this.attributes.fontFamily,t.fontsize=this.attributes.fontSize,t.fontweight=this.attributes.fontweight||!1,t.fontstyle=this.attributes.fontstyle||!1,t.align=this.attributes.align||"left",t},getProperties:function(){var t=ecEditor._.omitBy(ecEditor._.clone(this.attributes),ecEditor._.isObject);return t=ecEditor._.omitBy(t,ecEditor._.isNaN),delete t.__text,t.text=this.editorObj.text,this.pixelToPercent(t),t},updateFontSize:function(t,e){var i=void 0;if(e){var o=this.attributes.w*(this.magicNumber/100),r=this.editorWidth*this.attributes.w/100;i=parseInt(Math.round(t*(r/o)).toString())}else{var o=this.editorObj.width/this.magicNumber*100,r=this.editorObj.width/this.editorWidth*100,n=t*(this.editorObj.scaleX||1);i=parseFloat((n*(r/o)).toFixed(2))}return i},convertToFabric:function(t){var e=ecEditor._.clone(t);if(t.x&&(e.left=t.x),t.y&&(e.top=t.y),t.w&&(e.width=t.w),t.h&&(e.height=t.h),t.color&&(e.fill=t.color),t.weight&&ecEditor._.includes(t.weight,"bold")?(e.fontWeight="bold",t.fontweight=!0):t.fontweight=!1,t.weight&&ecEditor._.includes(t.weight,"italic")?(e.fontStyle="italic",t.fontstyle=!0):t.fontstyle=!1,t.font&&(e.fontFamily=t.font,t.fontFamily=t.font),t.fontsize){var i=this.updateFontSize(t.fontsize,!0);e.fontSize=i,t.fontSize=i}return t.align&&(e.textAlign=t.align,e.align=t.align),t.rotate&&(e.angle=t.rotate),this.isV2Plugin()||delete e.lineHeight,e},getConfigManifest:function(){var t=this._super();return ecEditor._.remove(t,function(t){return"stroke"===t.propertyName}),t},showReadalong:function(){var t=this,e=ecEditor.getCurrentObject();ecEditor.dispatchEvent("org.ekstep.readalongbrowser:showpopup",{textObj:e,callback:t.convertTexttoReadalong})},convertTexttoReadalong:function(t){var e=ecEditor.getCurrentObject(),i=ecEditor.getPluginInstance(e.id);TextWYSIWYG.resetProperties(e),e.config.text=e.editorObj.text=t.text,e.config.audio=t.audio,e.config.timings=t.timings,e.config.highlight=t.highlight,e.config.audioObj=t.audioObj,e.config.autoplay=t.autoplay,e.attributes.autoplay=t.autoplay,e.attributes.textType="readalong",textEditor.hide();var o=t.audioObj;ecEditor._.isUndefined(o)||(o.src=org.ekstep.contenteditor.mediaManager.getMediaOriginURL(o.src)),e.addMedia(o),i.addReadalongconfigManifest(e),ecEditor.dispatchEvent("config:show"),ecEditor.render()},showWordInfo:function(){var t=this,e=ecEditor.getCurrentObject();ecEditor.dispatchEvent("org.ekstep.wordinfobrowser:showpopup",{textObj:e,callback:t.convertTexttoWordinfo})},convertTexttoWordinfo:function(t,e){var i=ecEditor.getCurrentObject(),o=ecEditor.getPluginInstance(i.id);TextWYSIWYG.resetProperties(i),i.data=e,i.config.text=i.editorObj.text=t.text,i.config.words=t.words,i.config.wordfontcolor=t.wordfontcolor,i.config.wordhighlightcolor=t.wordhighlightcolor,i.config.wordunderlinecolor=t.wordunderlinecolor,i.attributes.textType="wordinfo",i.addMedia({id:"org.ekstep.text.popuptint",src:ecEditor.resolvePluginResource(o.manifest.id,o.manifest.ver,"assets/popuptint.png"),type:"image",assetId:"org.ekstep.text.popuptint"}),o.addWordinfoconfigManifest(i),ecEditor.dispatchEvent("config:show"),ecEditor.render()},deleteEnhancement:function(){ecEditor.getService("popup").open({template:"deleteConfirmationDialog",controller:["$scope",function(t){t.warningMessage="readalong"==ecEditor.getCurrentObject().attributes.textType?"Read-Along":"Word Info Popup",t.delete=function(){t.closeThisDialog();var e=ecEditor.getCurrentObject();"readalong"==e.attributes.textType?(delete e.config.audio,delete e.config.timings,delete e.config.highlight,delete e.config.audioObj,delete e.config.autoplay,delete e.attributes.autoplay):(delete e.data,delete e.config.words,delete e.config.wordfontcolor,delete e.config.wordhighlightcolor,delete e.config.wordunderlinecolor),e.attributes.textType="text",ecEditor.dispatchEvent("config:show"),ecEditor.render()}}],width:520,showClose:!1})},addReadalongconfigManifest:function(t){ecEditor.dispatchEvent("org.ekstep.text:addReadAlong",t)},addWordinfoconfigManifest:function(t){ecEditor.dispatchEvent("org.ekstep.text:addWordInfo",t)},getMedia:function(){var t=this;return"text"===t.attributes.textType?{}:t._super()},toECML:function(){var t=this._super();return this.isV2Plugin()&&(t=TextWYSIWYG.toECML(t)),t},fromECML:function(){this._super(this.editorData),this.isV2Plugin()&&TextWYSIWYG.fromECML(this)},isV2Plugin:function(t){var e=t||this;return!(!e.attributes.version||"V2"!==e.attributes.version)}});'))
org.ekstep.pluginframework.resourceManager.loadExternalResource('/plugins/org.ekstep.richtext-1.0/editor/libs/ckeditor.js', 'js')
org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.richtext","ver":"1.0","shortId":"org.ekstep.richtext","displayName":"Rich Text","author":"Kartheek Palla","title":"Text Plugin","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","dependencies":[{"type":"js","src":"editor/libs/ckeditor.js"},{"type":"template","src":"./richtexteditor.html","bundle":true},{"type":"ctrl","src":"./richtexteditorapp.js","bundle":true}],"behaviour":{"rotatable":false},"configManifest":[],"help":{"src":"editor/help.md","dataType":"text"}},"renderer":{"main":"renderer/richtextrendererplugin.js"}},eval('org.ekstep.contenteditor.basePlugin.extend({type:"org.ekstep.richtext",magicNumber:1920,editorWidth:720,richTextId:"richtext-wrapper",initialize:function(){var t=this;CKEDITOR.basePath=ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/libs/"),ecEditor.addEventListener(this.type+":showpopup",this.loadHtml,this),ecEditor.addEventListener("stage:unselect",this.removeHtmlElements,this),ecEditor.addEventListener("stage:create",this.removeHtmlElements,this),ecEditor.addEventListener(t.manifest.id+":adddiv",this.addDivElement,this),org.ekstep.contenteditor.api.getCanvas().on("object:scaling",this.resizeObject,this);var e=ecEditor.resolvePluginResource(t.manifest.id,t.manifest.ver,"editor/richtexteditor.html"),i=ecEditor.resolvePluginResource(t.manifest.id,t.manifest.ver,"editor/richtexteditorapp.js");ecEditor.getService("popup").loadNgModules(e,i);var r=document.createElement("div");r.setAttribute("id",this.richTextId),ecEditor.jQuery(".canvas-container").append(r)},newInstance:function(){var t=this;this.configManifest=_.remove(this.configManifest,function(t){return"stroke"!=t.propertyName});var e=this.convertToFabric(this.attributes);ecEditor._.isUndefined(this.config.text)&&(this.config.text=ecEditor._.isUndefined(this.attributes.__text)?"":this.attributes.__text),delete e.__text,this.editorObj=new fabric.Rect(e),this.editorObj.visible=!0,this.editorObj&&this.editorObj.setFill(e.fill),ecEditor.dispatchEvent(t.manifest.id+":adddiv",{data:t})},resizeObject:function(t){if(ecEditor.getCurrentObject()&&"org.ekstep.richtext"==ecEditor.getCurrentObject().manifest.id){var e=ecEditor.jQuery("#canvas").offset(),i=ecEditor.getCurrentObject().editorObj;ecEditor.jQuery("#"+t.target.id).offset({top:t.target.top+e.top,left:t.target.left+e.left}),i.width=t.target.getWidth(),i.height=t.target.getHeight(),ecEditor.jQuery("#"+t.target.id).width(t.target.getWidth()),ecEditor.jQuery("#"+t.target.id).height(t.target.getHeight())}},moving:function(t){var e=ecEditor.jQuery("#canvas").offset();ecEditor.jQuery("#"+this.editorObj.id).offset({top:this.editorObj.top+e.top,left:this.editorObj.left+e.left})},selected:function(t){fabric.util.addListener(fabric.document,"dblclick",this.dblClickHandler)},deselected:function(t,e,i){fabric.util.removeListener(fabric.document,"dblclick",this.dblClickHandler)},removed:function(t,e,i){ecEditor.jQuery("div#"+t.id).remove()},addDivElement:function(t,e){var i=ecEditor.jQuery("#canvas").offset(),r=document.createElement("div");r.setAttribute("id",e.data.id),r.style.position="absolute",r.style.fontSize="14px",r.style.fontFamily="NotoSans",r.style.width=e.data.editorObj.width?e.data.editorObj.width+1+"px":"auto",r.style.height=e.data.editorObj.height?e.data.editorObj.height+1+"px":"auto",r.style.pointerEvents="none",ecEditor.jQuery(".canvas-container #"+this.richTextId).append(r),ecEditor.jQuery(".canvas-container #"+this.richTextId+" div#"+e.data.id).html(e.data.config.text),ecEditor.jQuery("#"+e.data.id).offset({top:e.data.editorObj.top+i.top,left:Number(parseInt(ecEditor.jQuery(".canvas-container").css("margin-left")))+(e.data.editorObj.left+i.left)});var d=ecEditor.jQuery("#"+e.data.id).width(),o=ecEditor.jQuery("#"+e.data.id).height();ecEditor.jQuery("#"+e.data.id).width(d),ecEditor.jQuery("#"+e.data.id).height(o),e.data.editorObj.width=d,e.data.editorObj.height=o},dblClickHandler:function(t){"canvas"==t.target.tagName.toLowerCase()&&ecEditor.getCurrentObject()&&"org.ekstep.richtext"===ecEditor.getCurrentObject().manifest.id&&ecEditor.dispatchEvent("org.ekstep.richtext:showpopup",{textSelected:!0})},loadHtml:function(t,e){document.getElementsByClassName("richtextEditor_1").length>0||(this.textSelected=!!e&&e.textSelected,currentInstance=this,ecEditor.getService("popup").open({template:"richtexteditor",controller:"richtexteditorcontroller",controllerAs:"$ctrl",resolve:{instance:function(){return currentInstance}},data:{textSelected:this.textSelected},width:500,showClose:!1,className:"ngdialog-theme-plain richtextEditor_1"}))},render:function(t){t.add(this.editorObj),ecEditor.dispatchEvent(this.manifest.id+":adddiv",{data:this})},removeHtmlElements:function(){org.ekstep.contenteditor.api.jQuery("#"+this.richTextId).empty()},getAttributes:function(){var t=this._super();return t.fontSize=this.updateFontSize(ecEditor.jQuery("#"+this.richTextId).css("font-size"),!1),t},getConfig:function(){var t=this._super();return t.fontfamily=ecEditor.jQuery("#"+this.id).css("font-family"),t.fontsize=ecEditor.jQuery("#"+this.id).css("font-size"),t=_.omit(t,["stroke","strokeWidth"])},toECML:function(){return _.omit(this._super(),["__text"])},onConfigChange:function(t,e){var i="";switch(t){case"fontweight":_.each(ecEditor.jQuery("#"+this.id).children(),function(t){t.innerHTML="<strong>"+t.innerHTML+"</strong>",i+=t.outerHTML}),this.config.text=i;break;case"fontstyle":_.each(ecEditor.jQuery("#"+this.id).children(),function(t){t.innerHTML="<em>"+t.innerHTML+"</em>",i+=t.outerHTML}),this.config.text=i;break;case"fontsize":break;case"align":_.each(ecEditor.jQuery("#"+this.id).children(),function(t){t.style.textAlign=e,i+=t.outerHTML}),this.config.text=i}ecEditor.render(),ecEditor.dispatchEvent("object:modified",{target:ecEditor.getEditorObject()})},updateFontSize:function(t,e){var i,r,d=void 0;return e?(r=this.attributes.w*(this.magicNumber/100),d=this.editorWidth*this.attributes.w/100,i=parseInt(Math.round(t*(d/r)).toString())):(r=this.editorObj.width/this.magicNumber*100,d=this.editorObj.width/this.editorWidth*100,i=parseFloat((parseInt(t)*(d/r)).toFixed(2))),i}});'))
